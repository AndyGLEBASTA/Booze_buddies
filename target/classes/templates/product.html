<!DOCTYPE HTML>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<!--      th:fragment="main-fragment (title, otherStaticResources, header, SideMenu, mainContent, footer)">-->
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="star_rating.js"></script>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <title>Product Page</title>
    <link rel="stylesheet" type="text/css" th:href="@{/main.css}" href="../../../static/main.css"/>
    <title>Product Page</title>

</head>
<header>
    <h2>Booze buddy</h2>

</header>
<body>
<section>
    <SideMenu id="SideMenu">
        <li><a th:href="@{/buddy}">Home</a></li>
        <li><a th:href="@{/feed}">Feed</a></li>
        <li><a th:href="@{/notifications}">Notifications</a></li>
        <li><span style=vertical-align:bottom><a th:href="@{/logout}">Log out</a> </span></li>
    </SideMenu>
    <article>
        <div id="product_block">
            <div th:fragment="product">
                <p id="product_img" ><img src="layouts/img/product.png" alt="Product image"></p>
                <h1 th:text="${product.productName}"> Product_NAME </h1>
                <p th:text="${product['productCategory']['categoryName']}">Category_NAME</p>
                <div class="tabs">
                    <input type="radio" name="inset" value="" id="tab_1" checked>
                    <label for="tab_1">Rating</label>

                    <input type="radio" name="inset" value="" id="tab_2">
                    <label for="tab_2">Suggestions</label><br>

                    <div id="rating">
                        <div th:each="p : ${product.productReviews}">
                        <span th:text="${p.rateP1}"> Rate_P1</span> <span th:text="${p.rateP2}"> Rate_P2</span><br>
                        <span th:text="${p.rateP3}"> Rate_P3</span> <span th:text="${p.rateP4}"> Rate_P4</span></div>
                    </div>
                    <div id="suggestions" th:each="s : ${product.productCategory.suggestions}">
                        <span th:text="${s.foodName} + ${', '} + ${s.foodImg}"></span>
                    </div>
                    <br>
                </div>
            </div>
        </div><br>

        <input type="submit" value="AddReview" id="addBtn"/>

        <form id="addReviewForm" class="form-control" method="post" th:object="${productReview}">
            Review title:<br>
<!--            <input id="reviewTitle" placeholder="Enter Review Title" required type="text" name="reviewTitle" th:value="*{reviewTitle}">-->
            <br>
            <div><label for="reviewTitle"><input class="reviewTitlePr" id = "reviewTitle" type="text" th:value="${reviewTitle}" name="reviewTitle"/> </label></div>
            Review:<br>
<!--            <textarea id="reviewText" placeholder="Enter Your Review" name="reviewProduct" th:field="*{productReview.reviewProduct}"></textarea>-->
<!--            <br>-->
<!--            <input type="hidden" class="form-control" th:field="*{productReview.productId}">-->
<!--            &lt;!&ndash;    <input type="hidden" th:field="*{buddy}" th:value="${buddyId}">&ndash;&gt;-->
<!--            <br><br>-->
            <input name="Add review" id="submitButton" type="submit" value="add-review">
        </form>

        <div id="rateBlock" th:each="review : ${product.productReviews}">
            <p th:text="${review.buddy.firstName} + ${' '} + ${review.buddy.lastName}">Author</p>
            <p th:text="${review.buddy.avatarImg}">Img</p>
            <th><a th:href="@{/buddy/{id}(id=${review.buddy.buddyId})}"><img src="layouts/img/product.png" width="30"
                                                                            height="50" alt="Buddy image"></a></th>
            <p th:text="${review.reviewProduct}"> Review_title</p><br>
            <div id="rating_pr">
                <span th:text="${review.rateP1}"> Rate_P1</span> <span th:text="${review.rateP2}"> Rate_P2</span><br>
                <span th:text="${review.rateP3}"> Rate_P3</span> <span th:text="${review.rateP4}"> Rate_P4</span></div>
            <p id="reviewer_img"><img src="*{'data:image/png;base64, '+image}" alt="reviewer_img"></p><br>

<!--            <input type="submit" value="Редактировать" id="editBtn"/>-->

<!--            <form hidden name="reviewEd" method="POST" th:object="${productReview}" class="productReviewEdForm">-->
<!--                <input readonly id="productReviewId" type="number"  th:value="${productReviewId}"/><br>-->
<!--                <input id="reviewTitleEd" type="text" th:field="*{reviewTitle}" th:value="${reviewTitle}"/><br>-->
<!--                <textarea id="reviewProduct" th:field="*{reviewProduct}" th:value="${reviewProduct}"></textarea><br>-->
<!--                <input type="submit" value="Сохранить" id="btnSubmit"/>-->
<!--            </form>-->
        </div><br>
        <div id="business_block">
            <p align="center" id="business_img"><img src="*{'data:image/png;base64, '+image}" alt="business_img"></p><br>
            <div>
<!--                <p align="right"> <button onclick ="window.location.href='@{/{link}(link=${bR.businessLink})}';">Book a table</button></p>-->
                <!--        <p th:text="${busName} + ${', '} ${location}">Business_NAME, Business_TYPE</p>-->
                <div th:each = "bR : ${product.businesses}" ><p th:text="${bR.busName} + ${', '} + ${bR.location}">Business_NAME, Business_LocationE<p>
                    <p align="right"> <button onclick ="window.location.href='{{link}(link=${bR.businessLink})}';">Book a table</button></p>
                <th><a th:href="@{/business/{id}(id=${bR.businessId})}"><img src="layouts/img/product.png" width="30"
                                                                                 height="50" alt="Business image"></a></th>
                <p th:text="${Distance}">2 km away</p>
            </div>
            </div>
        </div><br>
    </article><br>
</section>
<style type="text/css">
    .param, .rating_new, #summ { line-height: 28px; }
    .stars, #sum_stars { background: url(../../../static/images/stars.png); }
    .stars, #sum_stars, .progress, #sum_progress {
        width: 130px;
        height: 28px;
        cursor: pointer;
    }
</style>
<div id="rating_new">
    <div class="param">Параметр 1:</div>
    <div><div class="stars"></div><p class="progress" id="p1"></p></div>
    <div class="rating_new" id="param1">5.0</div>

    <div class="param">Параметр 2:</div>
    <div><div class="stars"></div><p class="progress" id="p2"></p></div>
    <div class="rating_new" id="param2">5.0</div>

    <div class="param">Параметр 3:</div>
    <div><div class="stars"></div><p class="progress" id="p3"></p></div>
    <div class="rating_new" id="param3">5.0</div>


    <div class="param">Общая оценка:</div>
    <div><div id="sum_stars"></div><p id="sum_progress"></p></div>
    <div id="summ">5.00</div>

    <input id="el_999" type="submit" value="Submit">
    <p id="message"></p>
</div>
<script>
    $(document).ready(function (event) {
        $("#editBtn").on('click', function (event) {
            $("#productReviewEdForm").show();
        });
    });
    $(document).ready(function (event) {
        $("#submitButton").on('click', function (event) {
            $("#addReviewForm").show();
        });
    });
    $(function() {
        $('#btnSubmit').submit(function (e) {
            e.preventDefault();
            var review = $('#productReviewEdForm').serialize();
            console.log(review);
            $.ajax({
                type: 'POST',
                url: '/product/{id}/edit-review',
                data: review,
                contentType: "application/json; charset=utf-8",
                dataType: 'JSON',
                success: function(data){
                    console.log(data);
                }
            });
        });
    });

    $(document).ready(function () {
        $("#category").change(function () {
            $("#productId").val($("#product option:selected").attr("data-id"));
        });
    });

    $(function() {
        $('#submitButton').submit(function (e) {
            e.preventDefault();
            var review = $('#addReviewForm').serialize();
            console.log(review);
            $.ajax({
                type: 'POST',
                url: '$/product/{product.productId}',
                data: review,
                contentType: "application/json; charset=utf-8",
                dataType: 'JSON',
                success: function(data){
                    console.log(data);
                }
            });
        });
    });
    $(function() {
        $('#submitButton').submit(function (e) {
            e.preventDefault();
            var review = $('#addReviewForm').serialize();
            console.log(review);
            $.ajax({
                type: 'POST',
                url: '/product/{id}/{productReview_id}/edit-review',
                data: review,
                contentType: "application/json; charset=utf-8",
                dataType: 'JSON',
                success: function(data){
                    console.log(data);
                }
            });
        });
    });
</script>
</body>
<footer>
    <p>All right reserved and belong to almighty Cthulhu</p>
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>

</footer>
</html>